<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aliang.library.mapper.BookMapper4Ext">


    <!-- 采用resultType的方式，就要求SQL语句的返回字段和resultType指定的类的字段完全一一对应，
    多一个或者少一个字段都会抛异常 -->
    <select id="selectByConditions"
            resultType="com.aliang.library.entity.Book"
            parameterType="Map">
        select *
        from l_book
        where 1 = 1
        <if test="bookId != null">
            AND id = #{bookId}
        </if>
        <if test="author != null">
            AND author = #{author}
        </if>
        <if test="usable != null">
            AND usable = #{usable}
        </if>
        <if test="bookCount != null">
        AND book_count = #{usable}
        </if>
        <if test="bookName != null">
            AND book_name = #{bookName}
        </if>
        <if test="priceOrder != null">
            <if test='priceOrder == "asc"'>
                ORDER BY price ASC
            </if>
            <if test='priceOrder == "desc"'>
                ORDER BY price DESC
            </if>
        </if>
        <if test="limit != null">
            <choose>
                <when test="offset != null">
                    LIMIT #{offset}, #{limit}
                </when>
                <otherwise>
                    LIMIT #{limit}
                </otherwise>
            </choose>
        </if>
        ;
    </select>


    <select id="countByConditions"
            resultType="java.lang.Long"
            parameterType="Map">
        select count(*)
        from l_book
        ;
    </select>

    <update id="updateByPrimaryKey" parameterType="com.aliang.library.entity.Book">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update l_book
        set book_count = book_count - 1
        where id = #{id,jdbcType=INTEGER};
    </update>

    <update id="updateByPrimaryKeyStatus" parameterType="com.aliang.library.entity.Book">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update l_book
        set book_count = book_count + 1
        where id = #{id,jdbcType=INTEGER};
    </update>


</mapper>